#!/bin/bash

# @set
# -------------------------
shopt -s nocasematch

# @variable
# -------------------------
CMD_DIR=$(cd $(dirname $0); pwd)
CMD_ROOT=$(dirname $(dirname $(readlink -f $CMD_DIR/mcenv)))

# @func
# -------------------------
func_add() {
    [ ! -e $1 ] && echo "No file for the specified argument... ($1)" && exit 1
    case "$1" in
        *\.cnf)
            if [ -e $CMD_ROOT/configs/$1 ]; then 
                echo "A file with the same name already exists in the folder... ($CMD_ROOT/configs/)" 
                echo "hint: Execute the delete command first."
                exit 2
            fi
            cp $1 $CMD_ROOT/configs/$1
            ;;
        *)
         echo "The extensions do not match. (*.cnf)"
         exit 3
         ;;
       esac
}

func_link() {
    [ ! -e $1 ] && echo "No file for the specified argument... ($1)" && exit 4
    case "$1" in
        *\.cnf)
            if [ -e $CMD_ROOT/configs/$1 ]; then 
                echo "A file with the same name already exists in the folder... ($CMD_ROOT/configs/)" 
                echo "hint: Execute the delete command first."
                exit 5
            fi
            FULL_PATH=$(readlink -f $1)
            ln -sf $FULL_PATH $CMD_ROOT/configs/
            ;;
        *)
         echo "The extensions do not match. (*.cnf)"
         exit 6
         ;;
       esac
}

func_use() {
    :
}

func_list() {
    USE_CONF=$(cat $CMD_ROOT/version)
    for item in `ls -1 $CMD_ROOT/configs | sed -e 's/\.cnf$//'`; do
        if [ "$item" = "$USE_CONF" ]; then
            echo "* $item (set by $CMD_ROOT/config/$item.cnf)"
        else
            echo "  $item"
        fi
    done
}

func_manuel() {
    cat $CMD_ROOT/bin/manuel/usage.txt
}

# @main
# -------------------------
[ ! -e $CMD_ROOT/version ] && touch $CMD_ROOT/version

if [ $# -ne 0 ]; then
    declare op=$1
    case "$op" in
    "add")
        func_add $2
        ;;
    "link")
        func_link $2
        ;;
    "use")
        echo $HOME
        ;;
    "list")
        func_list
        ;;
    *)
        echo "No such command '${1}'"
        func_manuel
        exit 1
        ;;
    esac
else
    func_manuel
fi

exit 0
